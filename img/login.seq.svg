<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="728px" preserveAspectRatio="none" style="width:852px;height:728px;background:#FFFFFF;" version="1.1" viewBox="0 0 852 728" width="852px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="408.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="52" y="62.9766"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="256" y="108.5977"/><rect fill="#FFFFFF" height="193.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="412" y="247.8398"/><rect fill="#FFFFFF" height="32.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="614" y="380.082"/><rect fill="none" height="149.5527" style="stroke:#000000;stroke-width:1.5;" width="296.5" x="10" y="69.9766"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="198" x="20" y="152.9082"/><rect fill="none" height="173.5527" style="stroke:#000000;stroke-width:1.5;" width="826" x="20" y="486.0137"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="57" x2="57" y1="52.9766" y2="676.5664"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="260.5" x2="260.5" y1="52.9766" y2="676.5664"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="417" x2="417" y1="52.9766" y2="676.5664"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="618.5" x2="618.5" y1="52.9766" y2="676.5664"/><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="43" y="25.5352">App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="37" y="42.0234">Client</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="30" y="675.5664"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="43" y="696.1016">App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="37" y="712.5898">Client</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="225.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="235.5" y="25.5352">Identity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="232.5" y="42.0234">Provider</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="225.5" y="675.5664"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="235.5" y="696.1016">Identity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="232.5" y="712.5898">Provider</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68" x="383" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="403" y="25.5352">App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="390" y="42.0234">Lambda</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68" x="383" y="675.5664"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="403" y="696.1016">App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="390" y="712.5898">Lambda</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="583.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="37" x="600.5" y="25.5352">m-ld</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="590.5" y="42.0234">Gateway</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="583.5" y="675.5664"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="37" x="600.5" y="696.1016">m-ld</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="590.5" y="712.5898">Gateway</text><rect fill="#FFFFFF" height="408.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="52" y="62.9766"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="256" y="108.5977"/><rect fill="#FFFFFF" height="193.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="412" y="247.8398"/><rect fill="#FFFFFF" height="32.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="614" y="380.082"/><path d="M10,69.9766 L72,69.9766 L72,77.2871 L62,87.2871 L10,87.2871 L10,69.9766 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="149.5527" style="stroke:#000000;stroke-width:1.5;" width="296.5" x="10" y="69.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="83.5449">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="83" x="87" y="82.6113">[not logged in]</text><polygon fill="#181818" points="244,104.5977,254,108.5977,244,112.5977,248,108.5977" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="62" x2="250" y1="108.5977" y2="108.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="69" y="103.8555">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="82" y="103.8555">login</text><polygon fill="#181818" points="73,133.9082,63,137.9082,73,141.9082,69,137.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67" x2="260" y1="137.9082" y2="137.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="79" y="133.166">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="92" y="133.166">appToken</text><path d="M20,152.9082 L82,152.9082 L82,160.2188 L72,170.2188 L20,170.2188 L20,152.9082 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="198" x="20" y="152.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="35" y="166.4766">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70" x="97" y="165.543">[new device]</text><line style="stroke:#181818;stroke-width:1.0;" x1="62" x2="104" y1="191.5293" y2="191.5293"/><line style="stroke:#181818;stroke-width:1.0;" x1="104" x2="104" y1="191.5293" y2="204.5293"/><line style="stroke:#181818;stroke-width:1.0;" x1="63" x2="104" y1="204.5293" y2="204.5293"/><polygon fill="#181818" points="73,200.5293,63,204.5293,73,208.5293,69,204.5293" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="69" y="186.7871">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="82" y="186.7871">generate device key</text><polygon fill="#181818" points="400,243.8398,410,247.8398,400,251.8398,404,247.8398" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="62" x2="406" y1="247.8398" y2="247.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="69" y="243.0977">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="82" y="243.0977">get GW token (appToken, publicKey, domainName)</text><line style="stroke:#181818;stroke-width:1.0;" x1="422" x2="464" y1="277.1504" y2="277.1504"/><line style="stroke:#181818;stroke-width:1.0;" x1="464" x2="464" y1="277.1504" y2="290.1504"/><line style="stroke:#181818;stroke-width:1.0;" x1="423" x2="464" y1="290.1504" y2="290.1504"/><polygon fill="#181818" points="433,286.1504,423,290.1504,433,294.1504,429,290.1504" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="429" y="272.4082">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="442" y="272.4082">validate appToken</text><line style="stroke:#181818;stroke-width:1.0;" x1="422" x2="464" y1="319.4609" y2="319.4609"/><line style="stroke:#181818;stroke-width:1.0;" x1="464" x2="464" y1="319.4609" y2="332.4609"/><line style="stroke:#181818;stroke-width:1.0;" x1="423" x2="464" y1="332.4609" y2="332.4609"/><polygon fill="#181818" points="433,328.4609,423,332.4609,433,336.4609,429,332.4609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="429" y="314.7188">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="442" y="314.7188">check access</text><polygon fill="#181818" points="602,376.082,612,380.082,602,384.082,606,380.082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="422" x2="608" y1="380.082" y2="380.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="429" y="367.6846">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="442" y="360.0293">get config</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="442" y="375.3398">(publicKey, domainName)</text><path d="M629,345.4609 L629,385.4609 L786,385.4609 L786,355.4609 L776,345.4609 L629,345.4609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M776,345.4609 L776,355.4609 L786,355.4609 L776,345.4609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="635" y="363.0293">also ensures user is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="635" y="378.3398">in domain, if required</text><polygon fill="#181818" points="433,408.3926,423,412.3926,433,416.3926,429,412.3926" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="427" x2="618" y1="412.3926" y2="412.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="439" y="407.6504">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="452" y="407.6504">config</text><polygon fill="#181818" points="73,437.7031,63,441.7031,73,445.7031,69,441.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67" x2="416" y1="441.7031" y2="441.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="79" y="436.9609">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="92" y="436.9609">config</text><polygon fill="#181818" points="607,467.0137,617,471.0137,607,475.0137,611,471.0137" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="57" x2="613" y1="471.0137" y2="471.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="64" y="466.2715">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="86" y="466.2715">connect to domain (config)</text><path d="M20,486.0137 L94,486.0137 L94,493.3242 L84,503.3242 L20,503.3242 L20,486.0137 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="173.5527" style="stroke:#000000;stroke-width:1.5;" width="826" x="20" y="486.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="35" y="499.582">loop</text><line style="stroke:#181818;stroke-width:1.0;" x1="57" x2="99" y1="524.6348" y2="524.6348"/><line style="stroke:#181818;stroke-width:1.0;" x1="99" x2="99" y1="524.6348" y2="537.6348"/><line style="stroke:#181818;stroke-width:1.0;" x1="58" x2="99" y1="537.6348" y2="537.6348"/><polygon fill="#181818" points="68,533.6348,58,537.6348,68,541.6348,64,537.6348" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="64" y="519.8926">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="86" y="519.8926">sign operation (privateKey)</text><polygon fill="#181818" points="607,562.9453,617,566.9453,607,570.9453,611,566.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="57" x2="613" y1="566.9453" y2="566.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="64" y="562.2031">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="86" y="562.2031">operation</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="124" x="150" y="562.2031">via domain remotes</text><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="661" y1="596.2559" y2="596.2559"/><line style="stroke:#181818;stroke-width:1.0;" x1="661" x2="661" y1="596.2559" y2="609.2559"/><line style="stroke:#181818;stroke-width:1.0;" x1="620" x2="661" y1="609.2559" y2="609.2559"/><polygon fill="#181818" points="630,605.2559,620,609.2559,630,613.2559,626,609.2559" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="626" y="591.5137">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="648" y="591.5137">validate operation (publicKey)</text><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="661" y1="638.5664" y2="638.5664"/><line style="stroke:#181818;stroke-width:1.0;" x1="661" x2="661" y1="638.5664" y2="651.5664"/><line style="stroke:#181818;stroke-width:1.0;" x1="620" x2="661" y1="651.5664" y2="651.5664"/><polygon fill="#181818" points="630,647.5664,620,651.5664,630,655.5664,626,651.5664" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="626" y="633.8242">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="648" y="633.8242">log operation</text><!--MD5=[84904a5f4decdb9a7984864f5ec8fe86]
@startuml
'https://plantuml.com/sequence-diagram

autonumber

participant "App\nClient" as appC
participant "Identity\nProvider" as idp
participant "App\nLambda" as appL
participant "**m-ld**\nGateway" as gw

activate appC
alt not logged in
	appC -> idp ++ : login
	return appToken
	alt new device
		appC -> appC : generate device key
	end
end

appC -> appL ++ : get GW token (appToken, publicKey, domainName)
appL -> appL : validate appToken
appL -> appL : check access
appL -> gw ++ : get config\n(publicKey, domainName)
note right: also ensures user is\nin domain, if required
return config
return config

appC -> gw : connect to domain (config)
deactivate appC

loop
	appC -> appC : sign operation (privateKey)
	appC - -> gw : operation //via domain remotes//
	gw -> gw : validate operation (publicKey)
	gw -> gw : log operation
end

@enduml

@startuml

autonumber

participant "App\nClient" as appC
participant "Identity\nProvider" as idp
participant "App\nLambda" as appL
participant "**m-ld**\nGateway" as gw

activate appC
alt not logged in
	appC -> idp ++ : login
	return appToken
	alt new device
		appC -> appC : generate device key
	end
end

appC -> appL ++ : get GW token (appToken, publicKey, domainName)
appL -> appL : validate appToken
appL -> appL : check access
appL -> gw ++ : get config\n(publicKey, domainName)
note right: also ensures user is\nin domain, if required
return config
return config

appC -> gw : connect to domain (config)
deactivate appC

loop
	appC -> appC : sign operation (privateKey)
	appC - -> gw : operation //via domain remotes//
	gw -> gw : validate operation (publicKey)
	gw -> gw : log operation
end

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>